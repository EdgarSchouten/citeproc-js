<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>Citation Style Language</title>
<style type="text/css">

body { 
    width: 750px; 
    margin: auto; 
    position: center; 
    font-family: 'Lucida Sans', Verdana, sans-serif; 
    font-size: 10.5pt; 
    color: #434343;
    line-height: 135%; !important
}

.xml { padding: 1em; border: silver 1px solid; background: #EAFABC; }
.relaxngcompact { padding: 1em; border: silver 1px solid; background: #F6F9ED; }

.clothesline {
  position: relative;
}

.double-border {
  border: 5px double black;
}

h4 a {
  padding: 4px;
  border: 1px solid black;
}

/* .js { padding: 1em; border: silver 1px solid; background: #FFF68F; } */
.js { padding: 1em; border: silver 1px solid; background: #EAFABC; }
.text { padding: 1em; border: silver 1px solid; background: #FFcccc; }

dl { background: #B7FCE1; padding:1em; border: silver 1px solid;}
dt { font-weight: bold; margin-top: 0.5em; }

.info-version { text-align: center; font-size: 130%; font-weight: bold; }
.info-date { text-align: center; font-size: 110%; font-weight: bold; }
.title { text-align: center; margin: 4em 4em 1em 4em; }
.subtitle { text-align: center; margin: 1em 4em 4em 4em; }
.topic-title { font-weight: bold; font-size: 130%; }
.contents { margin-bottom: 1em; }
.center { text-align: center }



.contributors { margin-left: 250px; margin-top: 2em; margin-bottom: 2em; }
dl.contributors { background: white; border: none; }
.contributors dt { margin: 1em; }

span.sc {
  font-variant: small-caps;
  color: black;
}

tt.literal .pre {
  font-family: monospace;
  color: #232323;
  background: #d9d9d9;
  padding: 0px 2px 0px 2px;
}

a { 
    border-bottom: dotted 1px #999; 
    text-decoration: none;
}

blockquote {
    background: #B7FCE1; 
    margin-left: 3em;
    padding:1em; 
    border: silver 1px solid;
}

blockquote.inline-wrapper {
    background: white;
    margin: 0px;
    padding: 0px;
    border: 1px none black;
    text-align: center;
}

blockquote.inline-wrapper div {
    display: inline;
}

blockquote.inline-wrapper p {
    vertical-align: top;
    display: inline;
}

.superscript {
  margin-bottom: 1em;
}

a.toc-backref tt.literal .pre {
    background: white;
}


a:link { color: #636363; font-weight: bold;}
a:visited { color: #636363; font-weight: bold; }
a:active { color: #636363; font-weight: bold; }
a:hover { color: #a30826; font-weight: bold; }

a tt.literal .pre:link { color: #131313; }
a tt.literal .pre:visited { color: #131313; }
a tt.literal .pre:active { color: #131313; }
a tt.literal .pre:hover { color: #a30826; }

.contents a:link { color: #434343; font-weight: normal; }
.contents a:visited { color: #434343; font-weight: normal; }
.contents a:active { color: #434343; font-weight: normal; }
.contents a:hover { color: #a30826; }

a.toc-backref:link { color: black; } 
a.toc-backref:visited { color: black; } 
a.toc-backref:active { color: black; } 
a.toc-backref:hover { color: #a30826; }

blockquote.clothesline {
  position: relative;
  padding: 0px;
  margin: 0px;
  border: 0px none;
}

div.admonition {
  clear: both;
  border: 3px solid #c0c0c0;
  float: right;
  width: 37%;
  padding: 0px 5px 0px 5px;
  background: white;
  margin: -0.5em -0.5em 1em 5px;
}

blockquote.clothesline div.admonition {
  float: none;
  position: absolute;
  top: 0em;
  right: 0em;
}

div.admonition p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

div.admonition-important .admonition-title:before {
  content: url("important.png");
  padding-right: 5px;
}

div.admonition-hint .admonition-title:before {
  content: url("ktip.png");
  padding-right: 5px;
}

div.admonition p.admonition-title {
  font-weight: bold;
  font-size: 150%;
  border-bottom: 1px solid black;
  margin-top: 0px;
  margin-bottom: 0px;
  padding-top: 3px;
  padding-bottom: 3px;
}

table.footnote {
  background: #ffffdd;
  padding: 5px 0px 5px 0px;
  border: 1px solid #cccccc;
  margin: 0.3em 0px 0.3em 0px;
}

table.first {
  margin: 2.3em 0px 0.3em 0px;
}

table.hello { margin-left: 3em; }
table.hello td { padding: 3px; }
table.hello th { padding: 3px; background: #dddddd; }

table.footnote td.label {
  white-space: nowrap;
  padding-right: 0.3em;
}

a.fn-backref:before {
  content: url("2uparrow.png");
  padding-right: 2px;
}

a.footnote-reference {
  background: #ffffdd;
  padding: 5px 2px 0px 2px;
  white-space: nowrap;
}

a.footnote-reference:before {
  content: url("2downarrow.png");
  padding-right: 2px;
}

a.fn-backref {
  vertical-align: top;
}

/* .nx { color: red; font-weight: bold } */ /* Function name */

.c { color: #408080; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */

.k { color: #007020; font-weight: bold } /* Keyword  [DONE] */
.o { color: #666666 } /* Operator */
.cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cp { color: #BC7A00 } /* Comment.Preproc */
.c1 { color: #408080; font-style: italic } /* Comment.Single */
.cs { color: #408080; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #FF0000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #00A000 } /* Generic.Inserted */
.go { color: #808080 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0040D0 } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #7D9029 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #999999; font-weight: bold } /* Name.Entity */
.ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #A0A000 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #BB6688 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.il { color: #666666 } /* Literal.Number.Integer.Long */

table.codeblock, tr.codeblock, td.linenos, td.codeblock, table.codeblock pre { 
	margin: 0; 
	padding: 0; 
	border: 0; 
	vertical-align: baseline; 
	border: none; 
}

td.linenos { 
	border-right: 1px solid #AAAAAA; 
	text-align: right; 
	color: #AAAAAA; 
	padding-right: 5px; 
	padding-left: 5px; 
}

.codeblock { font-size: 110%; }

td.codeblock { padding-left: 5px; }
pre.codeblock { }
pre.codeblock span.Normal { }

pre.codeblock span.DataType { color: #902000; }
pre.codeblock span.DecVal { color: #40a070; }
pre.codeblock span.BaseN { color: #40a070; }
pre.codeblock span.Float { color: #40a070; }
pre.codeblock span.Char { color: #4070a0; }
pre.codeblock span.String { color: #4070a0; }
pre.codeblock span.Comment { color: #60a0b0; font-style: italic; }
pre.codeblock span.Others { color: #007020; }
pre.codeblock span.Alert { color: red; font-weight: bold; }
pre.codeblock span.Function { color: #06287e; }
pre.codeblock span.RegionMarker { }
pre.codeblock span.Error { color: red; font-weight: bold; }

</style>
</head>
<body>
<div class="document" id="citation-style-language">
<h1 class="title"><a class="reference internal" href="#table-of-contents">Citation Style Language</a></h1>
<h2 class="subtitle" id="manual-for-the-citeproc-js-processor">Manual for the <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> Processor</h2>

<!--  -->
<blockquote class="inline-wrapper">
<div align="center" class="align-center"><img alt="counter.gif" class="double-border align-center" src="counter.gif" /></div>
<p><a class="footnote-reference" href="#id5" id="id2">[1]</a></p>
</blockquote>
<p class="info-version">version 1.00<sub>a41</sub></p>
<p class="info-date">8 January 2010</p>
<dl class="contributors docutils">
<dt>Author of this manual</dt>
<dd><ul class="first last simple">
<li>Frank G. Bennett, Jr.</li>
</ul>
</dd>
<dt>With important feedback from</dt>
<dd><ul class="first last simple">
<li>Bruce D'Arcus</li>
<li>Lennard Fuller</li>
<li>Fergus Gallagher</li>
<li>Simon Kornblith</li>
<li>Dan Stillman</li>
<li>Rintze Zelle</li>
</ul>
</dd>
</dl>
<hr class="docutils" />
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id36">Introduction</a></li>
<li><a class="reference internal" href="#setup-and-system-requirements" id="id37">Setup and System Requirements</a><ul>
<li><a class="reference internal" href="#getting-the-citeproc-js-sources" id="id38">Getting the <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> sources</a></li>
<li><a class="reference internal" href="#run-rhino-sh" id="id39"><tt class="docutils literal"><span class="pre">run-rhino.sh</span></tt></a></li>
<li><a class="reference internal" href="#run-spidermonkey-py" id="id40"><tt class="docutils literal"><span class="pre">run-spidermonkey.py</span></tt></a></li>
<li><a class="reference internal" href="#run-tracemonkey-sh" id="id41"><tt class="docutils literal"><span class="pre">run-tracemonkey.sh</span></tt></a></li>
<li><a class="reference internal" href="#loading-runtime-code" id="id42">Loading runtime code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#processor-commands" id="id43">Processor Commands</a><ul>
<li><a class="reference internal" href="#csl-engine" id="id44"><tt class="docutils literal"><span class="pre">CSL.Engine()</span></tt></a></li>
<li><a class="reference internal" href="#updateitems" id="id45"><tt class="docutils literal"><span class="pre">updateItems()</span></tt></a></li>
<li><a class="reference internal" href="#makebibliography" id="id46"><tt class="docutils literal"><span class="pre">makeBibliography()</span></tt></a></li>
<li><a class="reference internal" href="#citation-commands" id="id47">Citation commands</a><ul>
<li><a class="reference internal" href="#appendcitationcluster" id="id48"><tt class="docutils literal"><span class="pre">appendCitationCluster()</span></tt></a></li>
<li><a class="reference internal" href="#processcitationcluster" id="id49"><tt class="docutils literal"><span class="pre">processCitationCluster()</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#setoutputformat" id="id50"><tt class="docutils literal"><span class="pre">setOutputFormat()</span></tt></a></li>
<li><a class="reference internal" href="#setabbreviations" id="id51"><tt class="docutils literal"><span class="pre">setAbbreviations()</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#local-environment" id="id52">Local Environment</a><ul>
<li><a class="reference internal" href="#system-functions" id="id53">System functions</a><ul>
<li><a class="reference internal" href="#retrievelocale" id="id54"><tt class="docutils literal"><span class="pre">retrieveLocale()</span></tt></a></li>
<li><a class="reference internal" href="#retrieveitem" id="id55"><tt class="docutils literal"><span class="pre">retrieveItem()</span></tt></a></li>
<li><a class="reference internal" href="#getabbreviations" id="id56"><tt class="docutils literal"><span class="pre">getAbbreviations()</span></tt></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#data-input" id="id57">Data Input</a><ul>
<li><a class="reference internal" href="#item-fields" id="id58">Item fields</a><ul>
<li><a class="reference internal" href="#text-and-numeric-variables" id="id59">Text and numeric variables</a></li>
<li><a class="reference internal" href="#names" id="id60">Names</a><ul>
<li><a class="reference internal" href="#names-with-particles" id="id61">Names with particles</a></li>
<li><a class="reference internal" href="#non-byzantine-names" id="id62">&quot;non-Byzantine&quot; names</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dates" id="id63">Dates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#citation-data-object" id="id64">Citation data object</a></li>
</ul>
</li>
<li><a class="reference internal" href="#output-formatting" id="id65">Output Formatting</a></li>
<li><a class="reference internal" href="#dirty-tricks" id="id66">Dirty Tricks</a><ul>
<li><a class="reference internal" href="#input-data-rescue" id="id67">Input data rescue</a><ul>
<li><a class="reference internal" href="#id24" id="id68">Names</a></li>
<li><a class="reference internal" href="#id25" id="id69">Dates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#processor-control" id="id70">Processor control</a><ul>
<li><a class="reference internal" href="#author-only" id="id71"><tt class="docutils literal"><span class="pre">author-only</span></tt></a></li>
<li><a class="reference internal" href="#suppress-author" id="id72"><tt class="docutils literal"><span class="pre">suppress-author</span></tt></a></li>
<li><a class="reference internal" href="#automating-text-insertions" id="id73">Automating text insertions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id31" id="id74">Multi-lingual content</a><ul>
<li><a class="reference internal" href="#the-lang-declaration" id="id75">The <tt class="docutils literal"><span class="pre">lang</span></tt> declaration</a></li>
<li><a class="reference internal" href="#title" id="id76">Title</a></li>
<li><a class="reference internal" href="#id34" id="id77">Names</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#test-suite" id="id78">Test Suite</a><ul>
<li><a class="reference internal" href="#fixture-layout" id="id79">Fixture layout</a><ul>
<li><a class="reference internal" href="#required-sections" id="id80">Required sections</a><ul>
<li><a class="reference internal" href="#mode" id="id81">MODE</a></li>
<li><a class="reference internal" href="#csl" id="id82">CSL</a></li>
<li><a class="reference internal" href="#input" id="id83">INPUT</a></li>
<li><a class="reference internal" href="#result" id="id84">RESULT</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optional-sections" id="id85">Optional sections</a><ul>
<li><a class="reference internal" href="#bibentries" id="id86">BIBENTRIES</a></li>
<li><a class="reference internal" href="#citation-items" id="id87">CITATION-ITEMS</a></li>
<li><a class="reference internal" href="#citations" id="id88">CITATIONS</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#preparing-and-running-the-tests" id="id89">Preparing and running the tests</a></li>
</ul>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id36">Introduction</a></h1>
<p>This is the site administrator's manual for <tt class="docutils literal"><span class="pre">citeproc-js</span></tt>, a
Javascript implementation of the <img alt="link" src="link.png" /> <a class="reference external" href="http://citationstyles.org/">Citation Style Language
(CSL)</a> used by Zotero, Mendeley and other popular reference
managers.  The processor complies with version 1.0 of the CSL
specification, has been written and tested as an independent module,
and can be run by any ECMAscript-compliant interpreter.  With an
appropriate supporting environment, <a class="footnote-reference" href="#id6" id="id3">[2]</a> it can be deployed in a
browser plugin, as part of a desktop application, or as a formatting
backend for a website or web service.</p>
<p>This manual covers the basic operation of the processor, including the
command set, the local system code that must be supplied by the integrator, and the
expected format of input data.  In addition, notes are provided on the test suite,
on the infrastructure requirements for running the processor in particular
environments, and on extended functionality that is available to address certain
special requirements.</p>
<p>Comments and complaints relating to this document and to the processor itself
will be gladly received and eventually despatched with.  The best channel
for providing feedback and getting help is the <img alt="link" src="link.png" /> <a class="reference external" href="http://groups.google.com/group/citeproc-js">project mailing list</a>.</p>
<table class="first docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>The counter graphic that appears on the title page was gleaned
from the Internet in the 1990s, and I do not have a record of its
original author.  If anyone can identify him or her, I will be
very happy to properly attribute this clever piece
of work.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td>For further details on required infrastructure, see the sections
<img alt="link" src="link.png" /> <a class="reference internal" href="#local-environment">Local Environment</a>
and <img alt="link" src="link.png" /> <a class="reference internal" href="#data-input">Data Input</a> below.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="setup-and-system-requirements">
<h1><a class="toc-backref" href="#id37">Setup and System Requirements</a></h1>
<p>The processor and its test framework can be run in two commonly
available Javascript environments, using the scripts <tt class="docutils literal"><span class="pre">test.py</span></tt> or
<tt class="docutils literal"><span class="pre">runtest.sh</span></tt>.  This manual does not cover the nitty-gritty of
setting up the environment for these scripts, but the basic system
requirements are described below.  If you get stuck and want advice,
or if you find something in this manual that is out of date or just
wrong, please feel free to drop a line to the <img alt="link" src="link.png" /> <a class="reference external" href="http://groups.google.com/group/citeproc-js">project list</a>.</p>
<div class="section" id="getting-the-citeproc-js-sources">
<h2><a class="toc-backref" href="#id38">Getting the <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> sources</a></h2>
<p>The <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> sources are hosted on <img alt="link" src="link.png" /> <a class="reference external" href="http://bitbucket.org/fbennett/citeproc-js/">BitBucket</a>.
To obtain the sources, install the <img alt="link" src="link.png" /> <a class="reference external" href="http://mercurial.selenic.com/wiki/">Mercurial version control system</a>
on a computer within your control (if you're on a Linux distro or a Mac,
just do a package install), and run the following command:</p>
<blockquote>
<pre class="literal-block">
hg clone http://bitbucket.org/fbennett/citeproc-js/
</pre>
</blockquote>
</div>
<div class="section" id="run-rhino-sh">
<h2><a class="toc-backref" href="#id39"><tt class="docutils literal"><span class="pre">run-rhino.sh</span></tt></a></h2>
<p>The simplest configuration for running tests is to use the <tt class="docutils literal"><span class="pre">run-rhino.sh</span></tt>
script (or <tt class="docutils literal"><span class="pre">run-rhino.bat</span></tt> on Windows systems).  If your OS has Java installed
(which most desktop and laptop systems nowadays seem to do), this will run
the full set of processor tests using a copy of the <tt class="docutils literal"><span class="pre">rhino</span></tt> Javascript interpreter
that ships with the <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> sources. <a class="footnote-reference" href="#id10" id="id9">[3]</a></p>
</div>
<div class="section" id="run-spidermonkey-py">
<h2><a class="toc-backref" href="#id40"><tt class="docutils literal"><span class="pre">run-spidermonkey.py</span></tt></a></h2>
<p>It is also possible to run the processor tests in the <tt class="docutils literal"><span class="pre">spidermonkey</span></tt>
interpreter using the <tt class="docutils literal"><span class="pre">run-spidermonkey.py</span></tt> script.  To use the
script, you will need to install the following items on your computer:</p>
<dl class="docutils">
<dt>Python 2.5 or higher</dt>
<dd>(Available as a package install in most Linux distributions.)</dd>
<dt>Python-spidermonkey bridge by Paul Davis</dt>
<dd><a class="reference external" href="http://github.com/davisp/python-spidermonkey">http://github.com/davisp/python-spidermonkey</a></dd>
<dt>Spidermonkey system library</dt>
<dd>(Available as a package install in most Linux distributions.
You may also be able to use the Spidermonkey sources that ship
with the <tt class="docutils literal"><span class="pre">python-spidermonkey</span></tt> bridge.)</dd>
</dl>
<p>If your Python is version 2.5, you will also need to install a
JSON package, such as <tt class="docutils literal"><span class="pre">simplejson</span></tt> or <tt class="docutils literal"><span class="pre">cjson</span></tt>.  Python 2.6
ships with a bundled JSON module, so there is no need to install
one separately if that's your version.</p>
</div>
<div class="section" id="run-tracemonkey-sh">
<h2><a class="toc-backref" href="#id41"><tt class="docutils literal"><span class="pre">run-tracemonkey.sh</span></tt></a></h2>
<p>The fastest configuration for testing uses the <tt class="docutils literal"><span class="pre">run-tracemonkey.py</span></tt>
script.  This is based on the <tt class="docutils literal"><span class="pre">jslibs</span></tt> development environment,
the sources for which can be obtained from <img alt="link" src="link.png" /> <a class="reference external" href="http://code.google.com/p/jslibs/">Google Code</a>.
(In the current version of the script, you will need to adjust
the <tt class="docutils literal"><span class="pre">TRACEMONKEY</span></tt> variable to point at the location of the
<tt class="docutils literal"><span class="pre">jshost</span></tt> binary installed on your system.)</p>
<p>As a rough speed comparison, on the netbook I have used for
<tt class="docutils literal"><span class="pre">citeproc-js</span></tt> development, run-rhino.sh currently completes the test
suite in about one minute, run-spidermonkey.py runs in about 30
seconds, and run-tracemonkey.sh finishes in about 15 seconds.
(These times are not really reflective of runtime performance,
since the test suite builds the processor from scratch hundreds
of times, while at runtime, citation rendering through a preconfigured
processor will be the dominant mode of operation.)</p>
</div>
<div class="section" id="loading-runtime-code">
<h2><a class="toc-backref" href="#id42">Loading runtime code</a></h2>
<p>The primary source code of the processor is located under <tt class="docutils literal"><span class="pre">./src</span></tt>,
for ease of maintenance.  The files necessary for use in a runtime
environment are catenated, in the appropriate sequence, in the
<tt class="docutils literal"><span class="pre">citeproc.js</span></tt> file, located in the root of the source archive.  This
file and the test fixtures can be refreshed using the
<tt class="docutils literal"><span class="pre">./tools/MAKETESTS.sh</span></tt> shell script.</p>
<p>To build the processor, the <tt class="docutils literal"><span class="pre">citeproc.js</span></tt> source code should be
loaded into the Javascript interpreter context, together with a
<tt class="docutils literal"><span class="pre">sys</span></tt> object provided by the integrator (see below), and the desired
CSL style (as a string).</p>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[3]</a></td><td>Note that two tests in the
current test suite will fail under <tt class="docutils literal"><span class="pre">rhino</span></tt>, due to string encoding issues.</td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="processor-commands">
<h1><a class="toc-backref" href="#id43">Processor Commands</a></h1>
<p>The processor command set will be a grave disappointment to those well versed in
the tormented intricacies of reference management and bibliography
formatting.  The processor is instantiated with a single command,
controlled with three others, and has just two commands for adjustments
to its runtime configuration.</p>
<div class="section" id="csl-engine">
<h2><a class="toc-backref" href="#id44"><tt class="docutils literal"><span class="pre">CSL.Engine()</span></tt></a></h2>
<p>A working instance of the processor can (well, must) be created using the
<tt class="docutils literal"><span class="pre">CSL.Engine()</span></tt> command, as shown in the code illustration below.
This command takes two required and one optional argument:</p>
<div class="admonition-important admonition">
<p class="first admonition-title">Important</p>
<p class="last">See the section <img alt="link" src="link.png" /> <a class="reference internal" href="#system-functions">Local Environment → System functions</a> below for guidance
on the definition of the functions contained in the <tt class="docutils literal"><span class="pre">sys</span></tt>
object.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">citeproc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CSL</span><span class="p">.</span><span class="nx">Engine</span><span class="p">(</span><span class="nx">sys</span><span class="o">,</span>
                              <span class="nx">style</span><span class="o">,</span>
                              <span class="nx">lang</span><span class="p">)</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><em>sys</em></dt>
<dd>A Javascript object containing the functions
<tt class="docutils literal"><span class="pre">retrieveLocale()</span></tt> and <tt class="docutils literal"><span class="pre">retrieveItem()</span></tt>.</dd>
<dt><em>style</em></dt>
<dd>A CSL style in serialized (string) form.</dd>
<dt><em>lang</em> (optional)</dt>
<dd>A language tag compliant with RFC 4646.  Defaults to <tt class="docutils literal"><span class="pre">en</span></tt>.
Styles that contain a <tt class="docutils literal"><span class="pre">default-locale</span></tt> declaration
on the <tt class="docutils literal"><span class="pre">style</span></tt> node will ignore this option.</dd>
</dl>
</div>
<div class="section" id="updateitems">
<h2><a class="toc-backref" href="#id45"><tt class="docutils literal"><span class="pre">updateItems()</span></tt></a></h2>
<p>Before citations or a bibliography can be generated, an ordered list
of reference items must ordinarily be loaded into the processor using
the <tt class="docutils literal"><span class="pre">updateItems()</span></tt> command, as shown below.  This command takes a
list of item IDs as its sole argument, and will reconcile the internal
state of the processor to the provided list of items, making any
necessary insertions and deletions, and making any necessary
adjustments to internal registers related to disambiguation and so
forth.</p>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">The sequence in which items are listed in the
argument to <tt class="docutils literal"><span class="pre">updateItems()</span></tt> will be reflected in the ordering
of bibliographies only if the style installed in the processor
does not impose its own sort order.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;ID-1&quot;</span><span class="o">,</span>
    <span class="s2">&quot;ID-53&quot;</span><span class="o">,</span>
    <span class="s2">&quot;ID-27&quot;</span>
<span class="p">]</span>

<span class="nx">citeproc</span><span class="p">.</span><span class="nx">updateItems</span><span class="p">(</span> <span class="nx">my_ids</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>Note that only IDs may be used to identify items.  The ID is an
arbitrary, system-dependent identifier, used by the locally customized
<tt class="docutils literal"><span class="pre">retrieveItem()</span></tt> and <tt class="docutils literal"><span class="pre">retrieveItems()</span></tt> methods to retrieve
actual item data.</p>
</div>
<div class="section" id="makebibliography">
<h2><a class="toc-backref" href="#id46"><tt class="docutils literal"><span class="pre">makeBibliography()</span></tt></a></h2>
<p>The <tt class="docutils literal"><span class="pre">makeBibliography()</span></tt> command does what its name implies.  The
command takes one optional argument.  If invoked without an argument,
it dumps a formatted bibliography containing all items currently
registered in the processor:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">citeproc</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">();</span>
</pre></div>
</td></tr></table>
</div>
<div class="admonition-important admonition" id="commands-categories">
<p class="first admonition-title">Important</p>
<p class="last">Matches against the content of name and date variables
are not possible, but empty fields can be matched for all
variable types.  See the <tt class="docutils literal"><span class="pre">quash</span></tt> example below
for details.</p>
</div>
<p>The optional argument is a nested Javascript object that may contain
<em>one of</em> the objects <tt class="docutils literal"><span class="pre">select</span></tt>, <tt class="docutils literal"><span class="pre">include</span></tt> or <tt class="docutils literal"><span class="pre">exclude</span></tt>, and
optionally an additional  <tt class="docutils literal"><span class="pre">quash</span></tt> object.  Each of these four objects
is an array containing one or more objects with <tt class="docutils literal"><span class="pre">field</span></tt> and <tt class="docutils literal"><span class="pre">value</span></tt>
attributes, each with a simple string value (see the examples below).
The matching behavior for each of the four object types, with accompanying
input examples, are as follows:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">select</span></tt></dt>
<dd>For each item in the bibliography, try every match object in the array against
the item, and include the item if, and only if, <em>all</em> of the objects match.</dd>
</dl>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">The target field in the data items registered in the processor
may either be a string or an array.  In the latter case,
an array containing a value identical to the
relevant value is treated as a match.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">myarg</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;select&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;book&quot;</span>
      <span class="p">}</span><span class="o">,</span>
      <span class="p">{</span>  <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;categories&quot;</span><span class="o">,</span>
          <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;1990s&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">cp</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="nx">myarg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">include</span></tt></dt>
<dd>Try every match object in the array against the item, and include the
item if <em>any</em> of the objects match.</dd>
</dl>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">myarg</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;include&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;book&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">cp</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="nx">myarg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">exclude</span></tt></dt>
<dd>Include the item if <em>none</em> of the objects match.</dd>
</dl>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">myarg</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;exclude&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;legal_case&quot;</span>
      <span class="p">}</span><span class="o">,</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;legislation&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">cp</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="nx">myarg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">quash</span></tt></dt>
<dd>Regardless of the result from <tt class="docutils literal"><span class="pre">select</span></tt>, <tt class="docutils literal"><span class="pre">include</span></tt> or <tt class="docutils literal"><span class="pre">exclude</span></tt>,
skip the item if <em>all</em> of the objects match.</dd>
</dl>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">An empty string given as the field value will match items
for which that field is missing or has a nil value.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">myarg</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;include&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;categories&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;classical&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span><span class="o">,</span>
   <span class="s2">&quot;quash&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;manuscript&quot;</span>
      <span class="p">}</span><span class="o">,</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;issued&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">cp</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="nx">myarg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>The value returned by this command is a two-element list, composed of
a Javascript array containing certain formatting parameters, and a
rendered string representing the bibliography itself.  The first
element—the array of formatting parameters—contains the key/value
pairs shown below (the values shown are the processor defaults):</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td class="code"><div class="highlight"><pre>  <span class="p">{</span> <span class="s2">&quot;maxoffset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
    <span class="s2">&quot;entryspacing&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span>
    <span class="s2">&quot;linespacing&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span>
<span class="s2">&quot;hangingindent&quot;</span><span class="o">:</span> <span class="mi">2</span>
  <span class="p">};</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><em>maxoffset</em></dt>
<dd>Some citation styles apply a label (either a number or an
alphanumeric code) to each bibliography entry, and use this label
to cite bibliography items in the main text.  In the bibliography,
the labels may either be hung in the margin, or they may be set
flush to the margin, with the citations indented by a uniform
amount to the right.  In the latter case, the amount of indentation
needed depends on the maximum width of any label.  The
<tt class="docutils literal"><span class="pre">maxoffset</span></tt> value gives the maximum number of characters that
appear in any label used in the bibliography.  The client that
controls the final rendering of the bibliography string should use
this value to calculate and apply a suitable indentation length.</dd>
<dt><em>entryspacing</em></dt>
<dd>An integer representing the spacing between entries in the bibliography.</dd>
<dt><em>linespacing</em></dt>
<dd>An integer representing the spacing between the lines within
each bibliography entry.</dd>
<dt><em>hangingindent</em></dt>
<dd>The number of em-spaces to apply in hanging indents within the
bibliography.</dd>
</dl>
</div>
<div class="section" id="citation-commands">
<h2><a class="toc-backref" href="#id47">Citation commands</a></h2>
<p>Citation commands generate strings for insertion into the text of a
target document.  Citations can be added to a document in one of two
ways: as a batch process (BibTeX, for example, works in this way) or
interactively (Endnote, Mendeley and Zotero work in this way, through
a connection to the user's word processing software).  These two modes
of operation are supported in <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> by two separate
commands, respectively <tt class="docutils literal"><span class="pre">appendCitationCluster()</span></tt>, and
<tt class="docutils literal"><span class="pre">processCitationCluster()</span></tt>.  A third, simpler command
(<tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt>), is not covered by this manual.
It is primarily useful as a tool for testing the processor, as it
lacks any facility for position evaluation, which is needed in
production environments.</p>
<p>The <tt class="docutils literal"><span class="pre">appendCitationCluster()</span></tt> and
<tt class="docutils literal"><span class="pre">processCitationCluster()</span></tt> commands use a similar input format
for citation data, which is described below in the <img alt="link" src="link.png" /> <a class="reference internal" href="#data-input">Data Input</a>
section below.</p>
<div class="section" id="appendcitationcluster">
<h3><a class="toc-backref" href="#id48"><tt class="docutils literal"><span class="pre">appendCitationCluster()</span></tt></a></h3>
<p>The <tt class="docutils literal"><span class="pre">appendCitationCluster()</span></tt> command takes a single citation
object as argument, and an optional flag to indicate whether
a full list of bibliography items has already been registered
in the processor with the <tt class="docutils literal"><span class="pre">updateItems()</span></tt> command.  If the flag
is true, the command should return an array containing exactly
one two-element array, consisting of the current index position
as the first element, and a string for insertion into the document
as the second.  To wit:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">appendCitationCluster</span><span class="p">(</span><span class="nx">mycitation</span><span class="o">,</span><span class="kc">true</span><span class="p">);</span>

<span class="p">[</span>
   <span class="p">[</span> <span class="mi">5</span><span class="o">,</span> <span class="s2">&quot;(J. Doe 2000)&quot;</span> <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
<p>If the flag is false, invocations of the command may return
multiple elements in the list, when the processor sense that
the additional bibliography items added by the citation require
changes to other citations to achieve disambiguation.  In this
case, a typical return value might look like this:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">appendCitationCluster</span><span class="p">(</span><span class="nx">mycitation</span><span class="p">);</span>

<span class="p">[</span>
   <span class="p">[</span> <span class="mi">2</span><span class="o">,</span> <span class="s2">&quot;(Jake Doe 2000)&quot;</span> <span class="p">]</span><span class="o">,</span>
   <span class="p">[</span> <span class="mi">5</span><span class="o">,</span> <span class="s2">&quot;(John Doe 2000)&quot;</span> <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="processcitationcluster">
<h3><a class="toc-backref" href="#id49"><tt class="docutils literal"><span class="pre">processCitationCluster()</span></tt></a></h3>
<p>The <tt class="docutils literal"><span class="pre">processCitationCluster()</span></tt> command is used to generate and
maintain citations dynamically in the text of a document.  It takes three
arguments: a citation object, a list of citation ID/note index pairs
representing existing citations that precede the target citation, and
a similar list of pairs for citations coming after the target.  Like
the <tt class="docutils literal"><span class="pre">appendCitationCluster()</span></tt> command run without a flag, its
return array may contain multiple elements, where the edit or
addition of a citation triggers changes to other citations:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">citationsPre</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s2">&quot;citation-abc&quot;</span><span class="o">,</span><span class="mi">1</span><span class="p">]</span><span class="o">,</span> <span class="p">[</span><span class="s2">&quot;citation-def&quot;</span><span class="o">,</span><span class="mi">2</span><span class="p">]</span> <span class="p">];</span>

<span class="k">var</span> <span class="nx">citationsPost</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s2">&quot;citation-ghi&quot;</span><span class="o">,</span><span class="mi">4</span><span class="p">]</span> <span class="p">];</span>

<span class="nx">citeproc</span><span class="p">.</span><span class="nx">processCitationCluster</span><span class="p">(</span><span class="nx">citation</span><span class="o">,</span><span class="nx">citationsPre</span><span class="o">,</span><span class="nx">citationsPost</span><span class="p">);</span>

<span class="p">[</span>
   <span class="p">[</span> <span class="mi">1</span><span class="o">,</span><span class="s2">&quot;(Ronald Snoakes 1950)&quot;</span> <span class="p">]</span><span class="o">,</span>
   <span class="p">[</span> <span class="mi">3</span><span class="o">,</span><span class="s2">&quot;(Richard Snoakes 1950)&quot;</span> <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
<p>A worked example showing the result of multiple transactions can be
found in the <a class="reference external" href="http://bitbucket.org/fbennett/citeproc-js/src/tip/tests/std/humans/integration_IbidOnInsert.txt">processor test suite</a>.</p>
</div>
</div>
<div class="section" id="setoutputformat">
<h2><a class="toc-backref" href="#id50"><tt class="docutils literal"><span class="pre">setOutputFormat()</span></tt></a></h2>
<p>The output format of the processor can be changed after instantiation
using the <tt class="docutils literal"><span class="pre">setOutputFormat()</span></tt> command.  This command is specific
to the <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> processor.</p>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">See the section <a class="reference internal" href="#output-formatting">Output Formatting</a> below for notes
on defining new output formats.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1</pre></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">setOutputFormat</span><span class="p">(</span><span class="s2">&quot;rtf&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="setabbreviations">
<h2><a class="toc-backref" href="#id51"><tt class="docutils literal"><span class="pre">setAbbreviations()</span></tt></a></h2>
<p>The processor recognizes abbreviation lists for journal titles, series
titles, authorities (such as the Supreme Court of New York), and
institution names (such as International Business Machines).  A list
can be set in the processor using the <tt class="docutils literal"><span class="pre">setAbbreviations()</span></tt> command,
with the name of the list as sole argument.  The named list is fetched
and installed by the <tt class="docutils literal"><span class="pre">sys.getAbbreviations()</span></tt> command, documented
below under <a class="reference internal" href="#local-environment">Local Environment</a> → <a class="reference internal" href="#system-functions">System Functions</a>.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1</pre></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">setAbbreviations</span><span class="p">(</span> <span class="s2">&quot;default&quot;</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
<div class="section" id="local-environment">
<h1><a class="toc-backref" href="#id52">Local Environment</a></h1>
<p>While <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> does a great deal of the heavy lifting needed
for correct formatting of citations and bibliographies, a certain
amount of programming is required to prepare the environment for its
correct operation.</p>
<div class="section" id="system-functions">
<h2><a class="toc-backref" href="#id53">System functions</a></h2>
<p>As mentioned above in the section on <img alt="link" src="link.png" /> <a class="reference internal" href="#csl-engine">CSL.Engine()</a>, two functions
must be defined separately and supplied to the processor upon
instantiation.  These functions are used by the processor to obtain
locale and item data from the surrounding environment.  The exact
definition of each may vary from one system to another; those given below
assume the existence of a global <tt class="docutils literal"><span class="pre">DATA</span></tt> object in the context of the
processor instance, and are provided only for the purpose of
illustration.</p>
<div class="section" id="retrievelocale">
<h3><a class="toc-backref" href="#id54"><tt class="docutils literal"><span class="pre">retrieveLocale()</span></tt></a></h3>
<p>The <tt class="docutils literal"><span class="pre">retrieveLocale()</span></tt> function is used internally by the processor to
retrieve the serialized XML of a given locale.  It takes a single RFC
4646 compliant language tag as argument, composed of a single language
tag (<tt class="docutils literal"><span class="pre">en</span></tt>) or of a language tag and region subtag (<tt class="docutils literal"><span class="pre">en-US</span></tt>).  The
name of the XML document in the CSL distribution that contains the
relevant locale data may be obtained from the <tt class="docutils literal"><span class="pre">CSL.localeRegistry</span></tt>
array.  The sample function below is provided for reference
only.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="highlight"><pre><span class="nx">sys</span><span class="p">.</span><span class="nx">retrieveLocale</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">lang</span><span class="p">){</span>
        <span class="k">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">DATA</span><span class="p">.</span><span class="nx">_locales</span><span class="p">[</span> <span class="nx">CSL</span><span class="p">.</span><span class="nx">localeRegistry</span><span class="p">[</span><span class="nx">lang</span><span class="p">]</span> <span class="p">];</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="o">;</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="retrieveitem">
<h3><a class="toc-backref" href="#id55"><tt class="docutils literal"><span class="pre">retrieveItem()</span></tt></a></h3>
<p>The <tt class="docutils literal"><span class="pre">retrieveItem()</span></tt> function is used by the processor to
fetch individual items from storage.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="nx">sys</span><span class="p">.</span><span class="nx">retrieveItem</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">id</span><span class="p">){</span>
        <span class="k">return</span> <span class="nx">DATA</span><span class="p">.</span><span class="nx">_items</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="getabbreviations">
<h3><a class="toc-backref" href="#id56"><tt class="docutils literal"><span class="pre">getAbbreviations()</span></tt></a></h3>
<p>The <tt class="docutils literal"><span class="pre">getAbbreviations()</span></tt> command is invoked by the processor
at startup, and when the <tt class="docutils literal"><span class="pre">setAbbreviations()</span></tt> command is
invoked on the instantiated processor.  The abbreviation list
retrieved by the processor should have the following structure:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></td><td class="code"><div class="highlight"><pre><span class="nx">ABBREVS</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;default&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;journal&quot;</span><span class="o">:</span><span class="p">{</span>
         <span class="s2">&quot;Journal of Irreproducible Results&quot;</span><span class="o">:</span><span class="s2">&quot;J. Irrep. Res.&quot;</span>
      <span class="p">}</span><span class="o">,</span>
      <span class="s2">&quot;series&quot;</span><span class="o">:</span><span class="p">{</span>
         <span class="s2">&quot;International Rescue Wildlife Series&quot;</span><span class="o">:</span><span class="s2">&quot;I.R. Wildlife Series&quot;</span>
      <span class="p">}</span><span class="o">,</span>
      <span class="s2">&quot;authority&quot;</span><span class="o">:</span><span class="p">{</span>
         <span class="s2">&quot;United States Patent and Trademark Office&quot;</span><span class="o">:</span> <span class="s2">&quot;USPTO&quot;</span>
              <span class="p">}</span><span class="o">,</span>
      <span class="s2">&quot;institution&quot;</span><span class="o">:</span><span class="p">{</span>
         <span class="s2">&quot;Bureau of Gaseous Unformed Stuff&quot;</span><span class="o">:</span><span class="s2">&quot;BoGUS&quot;</span>
      <span class="p">};</span>
   <span class="p">};</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
</div>
<p>If the object above provides the abbreviation store for the system,
an appropriate <tt class="docutils literal"><span class="pre">sys.getAbbreviations()</span></tt> function might look
like this:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="nx">sys</span><span class="p">.</span><span class="nx">getAbbreviations</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">name</span><span class="p">){</span>
   <span class="k">return</span> <span class="nx">ABBREVS</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
</div>
<div class="section" id="data-input">
<h1><a class="toc-backref" href="#id57">Data Input</a></h1>
<div class="section" id="item-fields">
<h2><a class="toc-backref" href="#id58">Item fields</a></h2>
<p>The locally defined <tt class="docutils literal"><span class="pre">retrieveItem()</span></tt> function must return data
for the target item as a simple Javascript array containing recognized
CSL fields. <a class="footnote-reference" href="#id21" id="id14">[4]</a>  The layout of the three field types is described below.</p>
<div class="section" id="text-and-numeric-variables">
<h3><a class="toc-backref" href="#id59">Text and numeric variables</a></h3>
<p>Text and numeric variables are not distinguished in the data layer; both
should be presented as simple strings.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;My Anonymous Life&quot;</span><span class="o">,</span>
   <span class="s2">&quot;volume&quot;</span> <span class="o">:</span> <span class="s2">&quot;10&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="names">
<h3><a class="toc-backref" href="#id60">Names</a></h3>
<p>When present in the item data, CSL name variables must
be delivered as a list of Javascript arrays, with one
array for each name represented by the variable.
Simple personal names are composed of <tt class="docutils literal"><span class="pre">family</span></tt> and <tt class="docutils literal"><span class="pre">given</span></tt> elements,
containing respectively the family and given name of the individual.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7
8
9</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="o">,</span> <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Jonathan&quot;</span> <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Roe&quot;</span><span class="o">,</span> <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Jane&quot;</span> <span class="p">}</span>
  <span class="p">]</span><span class="o">,</span>
  <span class="s2">&quot;editor&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Saunders&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;John Bertrand de Cusance Morant&quot;</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Institutional and other names that should always be presented
literally (such as &quot;The Artist Formerly Known as Prince&quot;,
&quot;Banksy&quot;, or &quot;Ramses IV&quot;) should be delivered as a single
<tt class="docutils literal"><span class="pre">literal</span></tt> element in the name array:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;literal&quot;</span> <span class="o">:</span> <span class="s2">&quot;Society for Putting Things on Top of Other Things&quot;</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<div class="section" id="names-with-particles">
<h4><a class="toc-backref" href="#id61">Names with particles</a></h4>
<p>Name particles, such as the &quot;von&quot; in &quot;Werner von Braun&quot;, can
be delivered separately from the family and given name,
as <tt class="docutils literal"><span class="pre">dropping-particle</span></tt> and <tt class="docutils literal"><span class="pre">non-dropping-particle</span></tt> elements.
Name suffixes such as the &quot;Jr.&quot; in &quot;Frank Bennett Jr.&quot; can be
delivered as a <tt class="docutils literal"><span class="pre">suffix</span></tt> element.</p>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">A simplified format for delivering particles and name suffixes
to the processor is described below in the section
<img alt="link" src="link.png" /> <a class="reference internal" href="#dirty-names">Dirty Tricks → Input data rescue → Names</a>.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Humboldt&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Alexander&quot;</span><span class="o">,</span>
      <span class="s2">&quot;dropping-particle&quot;</span> <span class="o">:</span> <span class="s2">&quot;von&quot;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Gogh&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Vincent&quot;</span><span class="o">,</span>
      <span class="s2">&quot;non-dropping-particle&quot;</span> <span class="o">:</span> <span class="s2">&quot;van&quot;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Stephens&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;James&quot;</span><span class="o">,</span>
      <span class="s2">&quot;suffix&quot;</span> <span class="o">:</span> <span class="s2">&quot;Jr.&quot;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;van der Vlist&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Eric&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="non-byzantine-names">
<span id="input-byzantine"></span><h4><a class="toc-backref" href="#id62">&quot;non-Byzantine&quot; names</a></h4>
<p>Names not written in the Latin or Cyrillic
scripts <a class="footnote-reference" href="#id22" id="id16">[5]</a> are always displayed
with the family name first.  No special hint is needed in
the input data; the processor is sensitive to the character
set used in the name elements, and will handle such names
appropriately.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;村上&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;春樹&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">When the romanized transliteration is selected from a multi-lingual
name field, the <tt class="docutils literal"><span class="pre">static-ordering</span></tt> flag is not required.  See the section
<img alt="link" src="link.png" /> <a class="reference internal" href="#multi-lingual-content">Dirty Tricks → Multi-lingual content</a> below for further details.</p>
</div>
<p>Sometimes it might be desired to handle a Latin or Cyrillic
transliteration as if it were a fixed (non-Byzantine) name.  This
behavior can be prompted by including a <tt class="docutils literal"><span class="pre">static-ordering</span></tt> element in
the name array.  The actual value of the element is irrelevant, so
long as it returns true when tested by the Javascript interpreter.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Murakami&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Haruki&quot;</span><span class="o">,</span>
      <span class="s2">&quot;static-ordering&quot;</span> <span class="o">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
<div class="section" id="dates">
<span id="input-dates"></span><h3><a class="toc-backref" href="#id63">Dates</a></h3>
<p>Date fields are Javascript objects, within which the &quot;date-parts&quot; element
is a nested Javascript array containing a start
date and optional end date, each of which consists of a year,
an optional month and an optional day, in that order if present.</p>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">A simplified format for providing date input
is described below in the section
<img alt="link" src="link.png" /> <a class="reference internal" href="#dirty-dates">Dirty Tricks → Input data rescue → Dates</a>.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="s2">&quot;2000&quot;</span><span class="o">,</span> <span class="s2">&quot;1&quot;</span><span class="o">,</span> <span class="s2">&quot;15&quot;</span> <span class="p">]</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Date elements may be expressed either as numeric strings or as
numbers.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="mi">1895</span><span class="o">,</span> <span class="mi">11</span> <span class="p">]</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>The <tt class="docutils literal"><span class="pre">year</span></tt> element may be negative, but never zero.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="o">-</span><span class="mi">200</span> <span class="p">]</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>A <tt class="docutils literal"><span class="pre">season</span></tt> element may
also be included.  If present, string or number values between <tt class="docutils literal"><span class="pre">1</span></tt> and <tt class="docutils literal"><span class="pre">4</span></tt>
will be interpreted to correspond to Spring, Summer, Fall, and Winter,
respectively.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="mi">1950</span> <span class="p">]</span>
      <span class="p">]</span><span class="o">,</span>
      <span class="s2">&quot;season&quot;</span> <span class="o">:</span> <span class="s2">&quot;1&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Other string values are permitted in the <tt class="docutils literal"><span class="pre">season</span></tt> element,
but note that these will appear in the output
as literal strings, without localization:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="mi">1975</span> <span class="p">]</span>
      <span class="p">]</span><span class="o">,</span>
      <span class="s2">&quot;season&quot;</span> <span class="o">:</span> <span class="s2">&quot;Trinity&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>For approximate dates, a <tt class="docutils literal"><span class="pre">circa</span></tt> element should be included,
with a non-nil value:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="o">-</span><span class="mi">225</span> <span class="p">]</span>
      <span class="p">]</span><span class="o">,</span>
      <span class="s2">&quot;circa&quot;</span> <span class="o">:</span> <span class="mi">1</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>To input a date range, add an array representing the end date,
with corresponding elements:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="mi">2000</span><span class="o">,</span> <span class="mi">11</span> <span class="p">]</span><span class="o">,</span>
         <span class="p">[</span> <span class="mi">2000</span><span class="o">,</span> <span class="mi">12</span> <span class="p">]</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>To specify an open-ended range, pass nil values for the end elements:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="mi">2008</span><span class="o">,</span> <span class="mi">11</span> <span class="p">]</span><span class="o">,</span>
         <span class="p">[</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span> <span class="p">]</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>A literal string may be passed through as a <tt class="docutils literal"><span class="pre">literal</span></tt> element:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;literal&quot;</span> <span class="o">:</span> <span class="s2">&quot;13th century&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
<div class="section" id="citation-data-object">
<h2><a class="toc-backref" href="#id64">Citation data object</a></h2>
<p>A minimal citation data object, used as input by both the <tt class="docutils literal"><span class="pre">processCitationCluster()</span></tt>
and <tt class="docutils literal"><span class="pre">appendCitationCluster()</span></tt> command, has the following form:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;citationItems&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;ITEM-1&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span><span class="o">,</span>
   <span class="s2">&quot;properties&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;noteIndex&quot;</span><span class="o">:</span> <span class="mi">1</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>The <tt class="docutils literal"><span class="pre">citationItems</span></tt> array is a list of one or more citation item
objects, each containing an <tt class="docutils literal"><span class="pre">id</span></tt> used to retrieve the bibliographic
details of the target resource.  A citation item object may contain
one or more additional optional values:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">locator</span></tt>: a string identifying a page number or other pinpoint
location or range within the resource;</li>
<li><tt class="docutils literal"><span class="pre">label</span></tt>: a label type, indicating whether the locator is to a
page, a chapter, or other subdivision of the target resource.  Valid
labels are defined in the <a class="reference external" href="http://citationstyles.org/">CSL specification</a>.</li>
<li><tt class="docutils literal"><span class="pre">suppress-author</span></tt>: if true, author names will not be included in the
citation output for this cite;</li>
<li><tt class="docutils literal"><span class="pre">author-only</span></tt>: if true, only the author name will be included
in the citation output for this cite -- this optional parameter
provides a means for certain demanding styles that require the
processor output to be divided between the main text and a footnote.
(See the section <a class="reference internal" href="#processor-control">Processor control</a>, in the Dirty Tricks section
below for more details.)</li>
<li><tt class="docutils literal"><span class="pre">prefix</span></tt>: a string to print before this cite item;</li>
<li><tt class="docutils literal"><span class="pre">suffix</span></tt>: a string to print after this cite item.</li>
</ul>
<p>In the <tt class="docutils literal"><span class="pre">properties</span></tt> portion of a citation, the <tt class="docutils literal"><span class="pre">noteIndex</span></tt>
value indicates the footnote number in which the citation is located
within the document.  Citations within the main text of the document
have a <tt class="docutils literal"><span class="pre">noteIndex</span></tt> of zero.</p>
<p>The processor will add a number of data items to a citation
during processing.  Values added at the top level of the citation
structure include:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">citationID</span></tt>: A unique ID assigned to the citation, for
internal use by the processor.  This ID may be assigned by the
calling application, but it must uniquely identify the citation,
and it must not be changed during processing or during an
editing session.</li>
<li><tt class="docutils literal"><span class="pre">sortedItems</span></tt>: This is an array of citation objects and accompanying
bibliographic data objects, sorted as required by the configured
style.  Calling applications should not need to access the data
in this array directly.</li>
</ul>
<p>Values added to individual citation item objects may include:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">sortkeys</span></tt>: an array of sort keys used by the processor to produce
the sorted list in <tt class="docutils literal"><span class="pre">sortedItems</span></tt>.  Calling applications should not
need to touch this array directly.</li>
<li><tt class="docutils literal"><span class="pre">position</span></tt>: an integer flag that indicates whether the cite item
should be rendered as a first reference, an immediately-following
reference (i.e. <em>ibid</em>), an immediately-following reference with locator
information, or a subsequent reference.</li>
<li><tt class="docutils literal"><span class="pre">first-reference-note-number</span></tt>: the number of the <tt class="docutils literal"><span class="pre">noteIndex</span></tt> of
the first reference to this resource in the document.</li>
<li><tt class="docutils literal"><span class="pre">near-note</span></tt>: a boolean flag indicating whether another reference
to this resource can be found within a specific number of notes,
counting back from the current position.  What is &quot;near&quot; in
this sense is style-dependent.</li>
</ul>
<p>Citations are registered and accessed by the processor internally
in arrays and Javascript objects.  Calling applications should
not need to access this data directly, but it is available in
the processor registry, at the following locations:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">registry</span><span class="p">.</span><span class="nx">citationreg</span><span class="p">.</span><span class="nx">citationById</span>

<span class="nx">citeproc</span><span class="p">.</span><span class="nx">registry</span><span class="p">.</span><span class="nx">citationreg</span><span class="p">.</span><span class="nx">citationByIndex</span>

<span class="nx">citeproc</span><span class="p">.</span><span class="nx">registry</span><span class="p">.</span><span class="nx">citationreg</span><span class="p">.</span><span class="nx">citationByItemId</span>
</pre></div>
</td></tr></table>
</div>
<table class="first docutils footnote" frame="void" id="id21" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id14">[4]</a></td><td>For information on valid CSL variable names, please
refer to the CSL specification, available via <a class="reference external" href="http://citationstyles.org/">http://citationstyles.org/</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id22" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id16">[5]</a></td><td>The Latin and Cyrillic scripts are referred to here collectively
as &quot;Byzantine scripts&quot;, after the confluence of cultures in the first
millenium that spanned both.</td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="output-formatting">
<h1><a class="toc-backref" href="#id65">Output Formatting</a></h1>
<p>The test fixtures assume HTML output, which the processor supports out
of the box as its default mode.  It is currently the only mode
supported in the distributed version of the code, but additional modes
can be created by adding definitions for them to the source file <tt class="docutils literal"><span class="pre">./src/formats.js</span></tt>.
See <a class="reference external" href="http://bitbucket.org/fbennett/citeproc-js/src/tip/src/formats.js">the file itself</a> for details; it's pretty straightforward.</p>
</div>
<div class="section" id="dirty-tricks">
<h1><a class="toc-backref" href="#id66">Dirty Tricks</a></h1>
<p>This section presents features of the <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> processor that
are not properly speaking a part of the CSL specification.  The
functionality described here may or may not be found in other CSL 1.0
compliant processors, when they arrive on the scene.</p>
<div class="section" id="input-data-rescue">
<h2><a class="toc-backref" href="#id67">Input data rescue</a></h2>
<div class="section" id="id24">
<span id="dirty-names"></span><h3><a class="toc-backref" href="#id68">Names</a></h3>
<p>Systems that use a simple two-field entry format can encode
<tt class="docutils literal"><span class="pre">non-dropping-particle</span></tt> and <tt class="docutils literal"><span class="pre">dropping-particle</span></tt>
elements on a name by including them in the <tt class="docutils literal"><span class="pre">family</span></tt>
or <tt class="docutils literal"><span class="pre">given</span></tt> fields, respectively, setting the <tt class="docutils literal"><span class="pre">parse-names</span></tt>
flag on the name object to indicate that the processor should
perform particle extraction on these fields:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Humboldt&quot;</span><span class="o">,</span>
       <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Alexander von&quot;</span><span class="o">,</span>
       <span class="s2">&quot;parse-names&quot;</span> <span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;van Gogh&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Vincent&quot;</span><span class="o">,</span>
      <span class="s2">&quot;parse-names&quot;</span> <span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>The extraction of &quot;non-dropping&quot; particles is done by scanning the
<tt class="docutils literal"><span class="pre">family</span></tt> field for leading terms that contain no uppercase letters.
The extraction of &quot;dropping&quot; particles is done by scanning the
<tt class="docutils literal"><span class="pre">given</span></tt> field for trailing terms that contain no uppercase letters.</p>
<p>For some names, leading lowercase terms in the <tt class="docutils literal"><span class="pre">family</span></tt> field should
be treated as part of the name itself, and not as particles.  The
<tt class="docutils literal"><span class="pre">parse-names</span></tt> flag should not be set on such names:
marks:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;van der Vlist&quot;</span><span class="o">,</span>
       <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Eric&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="id25">
<span id="dirty-dates"></span><h3><a class="toc-backref" href="#id69">Dates</a></h3>
<p>The <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> processor contains its own internal
parsing code for raw date strings.  Clients may take advantage of the
processor's internal parser by supplying date strings as a single
<tt class="docutils literal"><span class="pre">raw</span></tt> element:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;raw&quot;</span> <span class="o">:</span> <span class="s2">&quot;25 Dec 2004&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Note that the parsing of raw date strings is not part of the CSL 1.0
standard.  Clients that need to interoperate with other CSL
processors should be capable of preparing input in the form described
above under <a class="reference internal" href="#input-dates">Data Input → Dates</a>.</p>
</div>
</div>
<div class="section" id="processor-control">
<h2><a class="toc-backref" href="#id70">Processor control</a></h2>
<p>In ordinary operation, the processor generates citation strings
suitable for a given position in the document.  To support some use
cases, the processor is capable of delivering special-purpose
fragments of a citation.</p>
<div class="section" id="author-only">
<h3><a class="toc-backref" href="#id71"><tt class="docutils literal"><span class="pre">author-only</span></tt></a></h3>
<p>When the <tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt> command (not documented here) is
invoked with a non-nil <tt class="docutils literal"><span class="pre">author-only</span></tt> element, everything but the
author name in a cite is suppressed.  The name is returned without
decorative markup (italics, superscript, and so forth).</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="s2">&quot;ID-1&quot;</span><span class="o">,</span> <span class="p">{</span><span class="s2">&quot;author-only&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>You might think that printing the author of a cited work,
without printing the cite itself, is a useless thing to do.
And if that were the end of the story, you would be right ...</p>
</div>
<div class="section" id="suppress-author">
<h3><a class="toc-backref" href="#id72"><tt class="docutils literal"><span class="pre">suppress-author</span></tt></a></h3>
<p>To suppress the rendering of names in a cite, include a <tt class="docutils literal"><span class="pre">suppress-author</span></tt>
element with a non-nil value in the supplementary data:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;ID-1&quot;</span><span class="o">,</span> <span class="p">{</span> <span class="s2">&quot;locator&quot;</span><span class="o">:</span> <span class="s2">&quot;21&quot;</span><span class="o">,</span> <span class="s2">&quot;suppress-author&quot;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
<p>This option is useful on its own.  It can also be used in
combination with the <tt class="docutils literal"><span class="pre">author-only</span></tt> element, as described below.</p>
</div>
<div class="section" id="automating-text-insertions">
<h3><a class="toc-backref" href="#id73">Automating text insertions</a></h3>
<p>Calls to the <tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt> command with the <tt class="docutils literal"><span class="pre">author-only</span></tt>
and to <tt class="docutils literal"><span class="pre">processCitationCluster()</span></tt> or <tt class="docutils literal"><span class="pre">appendCitationCluster()</span></tt> with the
<tt class="docutils literal"><span class="pre">suppress-author</span></tt> control elements can be used to produce
cites that divide their content into two parts.  This permits the
support of styles such as the Chinese national standard style GB7714-87,
which requires formatting like the following:</p>
<blockquote>
<p><strong>The Discovery of Wetness</strong></p>
<p>While it has long been known that rocks are dry <sup>[1]</sup>
and that air is moist <sup>[2]</sup> it has been suggested by Source [3] that
water is wet.</p>
<p><strong>Bibliography</strong></p>
<p>[1] John Noakes, <em>The Dryness of Rocks</em> (1952).</p>
<p>[2] Richard Snoakes, <em>The Moistness of Air</em> (1967).</p>
<p>[3] Jane Roe, <em>The Wetness of Water</em> (2000).</p>
</blockquote>
<p>In an author-date style, the same passage should be rendered more or
less as follows:</p>
<blockquote>
<p><strong>The Discovery of Wetness</strong></p>
<p>While it has long been known that rocks are dry (Noakes 1952)
and that air is moist (Snoakes 1967) it has been suggested by Roe (2000)
that water is wet.</p>
<p><strong>Bibliography</strong></p>
<p>John Noakes, <em>The Dryness of Rocks</em> (1952).</p>
<p>Richard Snoakes, <em>The Moistness of Air</em> (1967).</p>
<p>Jane Roe, <em>The Wetness of Water</em> (2000).</p>
</blockquote>
<p>In both of the example passages above, the cites to Noakes and Snoakes
can be obtained with ordinary calls to citation processing commands.  The
cite to Roe must be obtained in two parts: the first with a call
controlled by the <tt class="docutils literal"><span class="pre">author-only</span></tt> element; and the second with
a call controlled by the <tt class="docutils literal"><span class="pre">suppress-author</span></tt> element, <em>in that order</em>:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="s2">&quot;ID-3&quot;</span><span class="o">,</span> <span class="p">{</span><span class="s2">&quot;author-only&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">}]</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">citeproc</span><span class="p">.</span><span class="nx">makeCitationCluster</span><span class="p">(</span> <span class="nx">my_ids</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>... and then ...</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">citation</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;citationItems&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;ID-3&quot;</span><span class="o">,</span> <span class="p">{</span><span class="s2">&quot;suppress-author&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">}]</span><span class="o">,</span>
  <span class="s2">&quot;properties&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;noteIndex&quot;</span><span class="o">:</span> <span class="mi">5</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">citeproc</span><span class="p">.</span><span class="nx">processCitationCluster</span><span class="p">(</span> <span class="nx">citation</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>In the first call, the processor will automatically suppress decorations (superscripting).
Also in the first call, if a numeric style is used, the processor will provide a localized
label in lieu of the author name, and include the numeric source identifier, free of decorations.
In the second call, if a numeric style is used, the processor will suppress output, since
the numeric identifier was included in the return to the first call.</p>
<p>Detailed illustrations of the interaction of these two control
elements are in the processor test fixtures in the
&quot;discretionary&quot; category:</p>
<ul class="simple">
<li><a class="reference external" href="http://bitbucket.org/fbennett/citeproc-js/src/tip/std/humans/discretionary_AuthorOnly.txt">AuthorOnly</a></li>
<li><a class="reference external" href="http://bitbucket.org/fbennett/citeproc-js/src/tip/std/humans/discretionary_CitationNumberAuthorOnlyThenSuppressAuthor.txt">CitationNumberAuthorOnlyThenSuppressAuthor</a></li>
<li><a class="reference external" href="http://bitbucket.org/fbennett/citeproc-js/src/tip/std/humans/discretionary_CitationNumberSuppressAuthor.txt">CitationNumberSuppressAuthor</a></li>
<li><a class="reference external" href="http://bitbucket.org/fbennett/citeproc-js/src/tip/std/humans/discretionary_SuppressAuthorSolo.txt">SuppressAuthorSolo</a></li>
</ul>
</div>
</div>
<div class="section" id="id31">
<span id="multi-lingual-content"></span><h2><a class="toc-backref" href="#id74">Multi-lingual content</a></h2>
<p>The version of <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> described by this manual incorporates
an experimental mechanism for supporting cross-lingual and
mixed-language citation styles, such as 我妻栄 [Wagatsuma Sakae],
<span class="sc">債権各論 [Obligations in Detail]</span> (1969).  While the scheme
described below cannot be considered
a permanent and stable solution to the problem of multi-lingual
citation management, it provides a platform for proof of concept, and
for the development of styles to support more robust multilingual support
when it arrives.</p>
<div class="section" id="the-lang-declaration">
<h3><a class="toc-backref" href="#id75">The <tt class="docutils literal"><span class="pre">lang</span></tt> declaration</a></h3>
<p>The <tt class="docutils literal"><span class="pre">style</span></tt> tag in a CSL style may contain a <tt class="docutils literal"><span class="pre">default-locale</span></tt> attribute.</p>
<!-- The clothesline construct below removes the hint box from the
normal flow, so that it overlays the code block below.  This
is necessary wherever the edge of the table containing the
code block might extend to the edge of a hint/important box. -->
<!--  -->
<blockquote class="clothesline">
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">When the <tt class="docutils literal"><span class="pre">default-locale</span></tt> attribute is omitted,
the default language is set to <tt class="docutils literal"><span class="pre">en-US</span></tt>.</p>
</div>
</blockquote>
<div class="codeblock xml">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;style</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://purl.org/net/xbiblio/csl&quot;</span>
    <span class="na">class=</span><span class="s">&quot;in-text&quot;</span>
    <span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
    <span class="na">default-locale=</span><span class="s">&quot;de&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;info&gt;</span>
    <span class="nt">&lt;id</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;updated&gt;</span>2009-08-10T04:49:00+09:00<span class="nt">&lt;/updated&gt;</span>
  <span class="nt">&lt;/info&gt;</span>
  <span class="nt">&lt;citation&gt;</span>
    <span class="nt">&lt;layout&gt;</span>
      <span class="nt">&lt;names</span> <span class="na">variable=</span><span class="s">&quot;author&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;name</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/names&gt;</span>
    <span class="nt">&lt;/layout&gt;</span>
  <span class="nt">&lt;/citation&gt;</span>
<span class="nt">&lt;/style&gt;</span>
</pre></div>
</td></tr></table>
</div>
<p>For multi-lingual operation, a style may be set to request alternative
versions and translations of the <tt class="docutils literal"><span class="pre">title</span></tt> field, and of the author
and other name fields, using an extension to the <tt class="docutils literal"><span class="pre">default-locale</span></tt>
attribute.  Extensions consist of an extension tag, followed by
a language setting that conforms to <a class="reference external" href="http://www.ietf.org/rfc/rfc4646.txt">RFC 4646</a> (typically constructed
from components listed in the <a class="reference external" href="http://www.iana.org/assignments/language-subtag-registry">IANA Language Subtag Registry</a>).  Recognized extension
tags are as follows:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">-x-pri-</span></tt></dt>
<dd>Sets a preferred language or translitertion for the title field.</dd>
<dt><tt class="docutils literal"><span class="pre">-x-sec-</span></tt></dt>
<dd>Sets an optional secondary translation for the title field.
If this tag is present, a translation in the target language
will (if available) be placed in square braces immediately  after the title text.</dd>
<dt><tt class="docutils literal"><span class="pre">-x-sort-</span></tt></dt>
<dd>Sets the preferred language or transliteration to be used for both the
title field and for names.</dd>
<dt><tt class="docutils literal"><span class="pre">-x-name-</span></tt></dt>
<dd>Sets the preferred language or transliteration for names.</dd>
</dl>
<p>The tags are applied to a style by appending them to the language
string in the <tt class="docutils literal"><span class="pre">default-locale</span></tt> element:</p>
<div class="codeblock xml">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;style</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://purl.org/net/xbiblio/csl&quot;</span>
    <span class="na">class=</span><span class="s">&quot;in-text&quot;</span>
    <span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
    <span class="na">default-locale=</span><span class="s">&quot;en-US-x-pri-ja-Hrkt&quot;</span><span class="nt">&gt;</span>
</pre></div>
</td></tr></table>
</div>
<p>Multiple tags may be specified, and tags are cumulative, and for
readability, individual tags may be separated by newlines within the
attribute.  The following will attempt to render titles in either
Pinyin transliteration (for Chinese titles) or Hepburn romanization
(for Japanese titles), sorting by the transliteration.</p>
<div class="codeblock xml">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7
8
9</pre></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;style</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://purl.org/net/xbiblio/csl&quot;</span>
    <span class="na">class=</span><span class="s">&quot;in-text&quot;</span>
    <span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
    <span class="na">default-locale=</span><span class="s">&quot;en-US</span>
<span class="s">        -x-pri-zh-Latn-pinyin</span>
<span class="s">        -x-pri-ja-Latn-hepburn</span>
<span class="s">        -x-sort-zh-Latn-pinyin</span>
<span class="s">        -x-sort-ja-Latn-hepburn&quot;</span><span class="nt">&gt;</span>
</pre></div>
</td></tr></table>
</div>
<p>Multi-lingual operation depends upon the presence of alternative
representations of field content embedded in the item data.  When
alternative field content is not availaable, the &quot;real&quot; field content
is used as a fallback.  As a result, configuration of language and
script selection parameters will have no effect when only a single
language is available (as will normally be the case for an ordinary
Zotero data store).</p>
</div>
<div class="section" id="title">
<h3><a class="toc-backref" href="#id76">Title</a></h3>
<p>For titles, alternative representations are appended
directly to the field content, separated by the appropriate
language tag with a leading and trailing colon:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;民法 :ja-Latn-hepburn-heploc: Minpō :en: Civil Code&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="id34">
<h3><a class="toc-backref" href="#id77">Names</a></h3>
<p>For personal names, alternative representations should be presented
as separate &quot;name&quot; entries, immediately following the original
for the name element to which they apply.  For example:</p>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">As described above, fixed ordering is used for
<img alt="link" src="link.png" /> <a class="reference internal" href="#input-byzantine">non-Byzantine names</a>.  When such
names are transliterated, the <tt class="docutils literal"><span class="pre">static-ordering</span></tt> element is
set on them, to preserve their original formatting behavior.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;穂積&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;陳重&quot;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;:ja-Latn: Hozumi&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Nobushige&quot;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;中川&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;善之助&quot;</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;:ja-Latn: Nakagawa&quot;</span><span class="o">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Zennosuke&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
</div>
<div class="section" id="test-suite">
<h1><a class="toc-backref" href="#id78">Test Suite</a></h1>
<p><tt class="docutils literal"><span class="pre">Citeproc-js</span></tt> ships with a large bundle of test data and a set of
scripts that can be used to confirm that the system performs correctly
after installation.  The tests begin as individual human-friendly
fixtures written in a special format, shown in the sample file
immediately below.  In prepare the tests for use, each is ground into
a machine-friendly form (JSON), and a Javascript execution wrapper for
each fixture is registered in the processor test framework.  The tests
are then processed in a separate operation by invoking one of the
top-level test runner commands.</p>
<p>This section describes the arrangement of the files, the internal
layout of the human-readable version of the text fixtures, the scripts
used to manage the text fixture bundle, and the commands used to
actually run the tests.</p>
<div class="section" id="fixture-layout">
<h2><a class="toc-backref" href="#id79">Fixture layout</a></h2>
<p>The human-readable version of each test fixture is composed in
the format below.  The five sections <tt class="docutils literal"><span class="pre">MODE</span></tt>,
<tt class="docutils literal"><span class="pre">RESULT</span></tt>, <tt class="docutils literal"><span class="pre">CSL</span></tt> and <tt class="docutils literal"><span class="pre">INPUT</span></tt> are required, and may be
arranged in any order within the fixture file.  As the
sample below illustrates, text outside of the section
delimiters is ignored.  The sample file below shows the
layout of a typical fixture.  See the explanations of
the individual sections further below for information on
the usage of each.</p>
<!--  -->
<blockquote class="clothesline">
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">Three additional sections are available for special
purposes.  The optional sections <tt class="docutils literal"><span class="pre">ABBREVIATIONS</span></tt>,
<tt class="docutils literal"><span class="pre">BIBENTRIES</span></tt>, <tt class="docutils literal"><span class="pre">CITATIONS</span></tt> and <tt class="docutils literal"><span class="pre">CITATION-ITEMS</span></tt>
are also explained below.</p>
</div>
</blockquote>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== MODE =====&gt;&gt;
citation
&lt;&lt;===== MODE =====&lt;&lt;

# Everything between the section blocks is
# ignored.  Comment markup can be used for
# clarity, but it is not required.


&gt;&gt;===== RESULT =====&gt;&gt;
John Doe
&lt;&lt;===== RESULT =====&lt;&lt;


&gt;&gt;===== CSL =====&gt;&gt;
&lt;style
      xmlns=&quot;http://purl.org/net/xbiblio/csl&quot;
      class=&quot;in-text&quot;
      version=&quot;1.0&quot;&gt;
  &lt;info&gt;
    &lt;id /&gt;
    &lt;title /&gt;
    &lt;updated&gt;2009-08-10T04:49:00+09:00&lt;/updated&gt;
  &lt;/info&gt;
  &lt;citation&gt;
    &lt;layout&gt;
      &lt;names variable=&quot;author&quot;&gt;
        &lt;name /&gt;
      &lt;/names&gt;
    &lt;/layout&gt;
  &lt;/citation&gt;
&lt;/style&gt;
&lt;&lt;===== CSL =====&lt;&lt;


&gt;&gt;===== INPUT =====&gt;&gt;
[
   {
      &quot;id&quot;:&quot;ID-1&quot;,
      &quot;type&quot;: &quot;book&quot;,
      &quot;author&quot;: [
         { &quot;name&quot;:&quot;Doe, John&quot; }
      ],
      &quot;issued&quot;: {
         &quot;date-parts&quot;: [
            [
               &quot;1965&quot;,
               &quot;6&quot;,
               &quot;1&quot;
            ]
         ]
      }
   }
]
&lt;&lt;===== INPUT =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
<div class="section" id="required-sections">
<h3><a class="toc-backref" href="#id80">Required sections</a></h3>
<p>The following five sections are required in all test fixtures.</p>
<div class="section" id="mode">
<h4><a class="toc-backref" href="#id81">MODE</a></h4>
<p>A single string tells whether to test <tt class="docutils literal"><span class="pre">citation</span></tt> or <tt class="docutils literal"><span class="pre">bibliography</span></tt>
output, using the <tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt> and <tt class="docutils literal"><span class="pre">makeBibliography()</span></tt>
processor commands, respectively:</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== MODE =====&gt;&gt;
citation
&lt;&lt;===== MODE =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="csl">
<h4><a class="toc-backref" href="#id82">CSL</a></h4>
<p>The code to be used in the test must be valid
as a complete, if minimal, CSL style:</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== CSL =====&gt;&gt;
&lt;style
      xmlns=&quot;http://purl.org/net/xbiblio/csl&quot;
      class=&quot;in-text&quot;
      version=&quot;1.0&quot;&gt;
  &lt;info&gt;
    &lt;id /&gt;
    &lt;title /&gt;
    &lt;updated&gt;2009-08-10T04:49:00+09:00&lt;/updated&gt;
  &lt;/info&gt;
  &lt;citation
    et-al-min=&quot;3&quot;
    et-al-use-first=&quot;1&quot;&gt;
    &lt;layout delimiter=&quot;; &quot;&gt;
      &lt;group delimiter=&quot; &quot;&gt;
        &lt;names&gt;
          &lt;name form=&quot;short&quot;/&gt;
        &lt;/names&gt;
        &lt;date
            variable=&quot;issued&quot;
            date-parts=&quot;year&quot;
            form=&quot;text&quot;
            prefix=&quot;(&quot;
            suffix=&quot;)&quot;/&gt;
      &lt;/group&gt;
    &lt;/layout&gt;
  &lt;/citation&gt;
  &lt;bibliography&gt;
    &lt;layout&gt;
      &lt;group delimiter=&quot; &quot;&gt;
        &lt;names variable=&quot;author&quot;&gt;
          &lt;name delimiter=&quot; &quot; initialize-with=&quot;.&quot;/&gt;
        &lt;/names&gt;
        &lt;date
            variable=&quot;issued&quot;
            date-parts=&quot;year&quot;
            form=&quot;text&quot;
            prefix=&quot;(&quot;
            suffix=&quot;)&quot;/&gt;
      &lt;/group&gt;
    &lt;/layout&gt;
  &lt;/bibliography&gt;
&lt;/style&gt;
&lt;&lt;===== CSL =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="input">
<h4><a class="toc-backref" href="#id83">INPUT</a></h4>
<p>The <tt class="docutils literal"><span class="pre">INPUT</span></tt> section provides the item data to be registered
in the processor.  In a simple test fixture that contains
neither a <tt class="docutils literal"><span class="pre">BIBENTRIES</span></tt> nor a <tt class="docutils literal"><span class="pre">CITATIONS</span></tt> section,
a citation or bibligraphy is requested for <em>all</em> of the
items in the <tt class="docutils literal"><span class="pre">INPUT</span></tt> section (where one of those two
optional sections is included, the testing behavior is slightly
different; see the discussion of the relevant sections below
for details):</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== INPUT =====&gt;&gt;
[
 {
   &quot;id&quot;:&quot;ID-1&quot;,
   &quot;author&quot;: [
        { &quot;name&quot;:&quot;Noakes, John&quot; },
        { &quot;name&quot;:&quot;Doe, John&quot; },
        { &quot;name&quot;:&quot;Roe, Jane&quot; }
   ],
   &quot;issued&quot;: {
      &quot;date-parts&quot;: [
         [
            2005
         ]
      ]
   }
 },
 {
   &quot;id&quot;:&quot;ID-2&quot;,
   &quot;author&quot;: [
        { &quot;name&quot;:&quot;Stoakes, Richard&quot; }
   ],
   &quot;issued&quot;: {
      &quot;date-parts&quot;: [
         [
            1898
         ]
      ]
   }
 }
]
&lt;&lt;===== INPUT =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="result">
<h4><a class="toc-backref" href="#id84">RESULT</a></h4>
<p>A string to compare with the citation or bibliography output
received from the processor.</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== RESULT =====&gt;&gt;
(Noakes, et al. 2005; Stoakes 1898)
&lt;&lt;===== RESULT =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
<p>Note that in <tt class="docutils literal"><span class="pre">bibliography</span></tt> mode, the HTML string output
used for testing will be affixed with a standard set of
wrapper tags, which must be written into the result string
used for comparison:</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== RESULT =====&gt;&gt;
&lt;div class=&quot;csl-bib-body&quot;&gt;
  &lt;div class=&quot;csl-entry&quot;&gt;J. Noakes, J. Doe, J. Roe (2005)&lt;/div&gt;
  &lt;div class=&quot;csl-entry&quot;&gt;R. Stoakes (1898)&lt;/div&gt;
&lt;/div&gt;
&lt;&lt;===== RESULT =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
</div>
<div class="section" id="optional-sections">
<h3><a class="toc-backref" href="#id85">Optional sections</a></h3>
<p>Three optional sections may be included in a fixture
to exercise special aspects of processor behavior.</p>
<div class="section" id="bibentries">
<h4><a class="toc-backref" href="#id86">BIBENTRIES</a></h4>
<p>The <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> processor maintains a persistent internal
registry of citation data, and permits the addition, deletion
and rearrangement of registered items.  The correct operation
of this functionality is quite important, because interaction
with word processors and other authoring systems depends upon it.
The behavior of the processor across a series of update transactions
can be tested by including <tt class="docutils literal"><span class="pre">BIBENTRIES</span></tt> section.
When included, the section should
consist of a two-tier list, consisting of discrete lists of IDs,
which must
correspond to items registered in the <tt class="docutils literal"><span class="pre">INPUT</span></tt> section:</p>
<!--  -->
<blockquote class="clothesline">
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">The test of output will be run after first updating the
processor's internal registry to reflect each of the
requested citation sets, and should correctly reflect the
last in the series.</p>
</div>
</blockquote>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== BIBENTRIES =====&gt;&gt;
[
  [
    &quot;ITEM-1&quot;,
    &quot;ITEM-2&quot;,
    &quot;ITEM-3&quot;,
    &quot;ITEM-4&quot;,
    &quot;ITEM-5&quot;
  ],
  [
    &quot;ITEM-1&quot;,
    &quot;ITEM-4&quot;,
    &quot;ITEM-5&quot;
  ]
]
&lt;&lt;===== BIBENTRIES =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="citation-items">
<h4><a class="toc-backref" href="#id87">CITATION-ITEMS</a></h4>
<p>When testing in <tt class="docutils literal"><span class="pre">citation</span></tt> mode, the data items to be
processed are ordinarily rendered as a single citation.
To test operations that depend upon or may be affected
by the internal state of the processor across a session,
either a <tt class="docutils literal"><span class="pre">CITATION-ITEMS</span></tt> or a <tt class="docutils literal"><span class="pre">CITATIONS</span></tt> section
may be included in the test fixture.</p>
<p><tt class="docutils literal"><span class="pre">CITATION-ITEMS</span></tt> is the simpler of the two, used in
most of the standard processor formatting test fixtures.
The data input in this area should consist of a list array
of cite data, where each cite consists of a Javascript object
containing, at least, item ID.
A single citation is composed of a list of cites, and
the full entry consists of a list of such citations:</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== CITATION-ITEMS =====&gt;&gt;
[
  [
    [{&quot;id&quot;: &quot;ITEM-1&quot;}]
  ],
  [
    [{&quot;id&quot;: &quot;ITEM-2&quot;, &quot;label&quot;: &quot;page&quot;, &quot;locator&quot;: &quot;23&quot;}]
    [{&quot;id&quot;:&quot;ITEM-3&quot;}]
  ]
]
&lt;&lt;===== CITATION-ITEMS =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="citations">
<h4><a class="toc-backref" href="#id88">CITATIONS</a></h4>
<p>A <tt class="docutils literal"><span class="pre">CITATIONS</span></tt> area can be used (instead of <tt class="docutils literal"><span class="pre">CITATION-ITEMS</span></tt>)
to mimic a series of interactions with a word processor plugin.
In this case, the area should contain a list array of citation
data objects with explict <tt class="docutils literal"><span class="pre">citationID</span></tt> values and ID list values
for subsequent invocations of the <tt class="docutils literal"><span class="pre">processCitationCluster()</span></tt> command,
like the following:</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== CITATIONS =====&gt;&gt;
[
   [
      {
         &quot;citationID&quot;: &quot;CITATION-1&quot;,
         &quot;citationItems&quot;: [
            {
               &quot;id&quot;: &quot;ITEM-1&quot;
            }
         ],
         &quot;properties&quot;: {
            &quot;noteIndex&quot;: 1
         }
      },
      [],
      []
   ],
   [
      {
         &quot;citationID&quot;: &quot;CITATION-2&quot;,
         &quot;citationItems&quot;: [
            {
               &quot;id&quot;: &quot;ITEM-2&quot;,
               &quot;locator&quot;: 15
            },
            {
               &quot;id&quot;: &quot;ITEM-3&quot;
            }
         ],
         &quot;properties&quot;: {
            &quot;noteIndex&quot;: 1
         }
      }
   ],
   [&quot;CITATION-1&quot;],
   []
]
&lt;&lt;===== CITATIONS =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
</div>
</div>
<div class="section" id="preparing-and-running-the-tests">
<h2><a class="toc-backref" href="#id89">Preparing and running the tests</a></h2>
<p>The following commands are used to process and run
the tests.  For further information, see the source
code of the relevant scripts, or drop me a line.</p>
<p><strong>Test preparation</strong></p>
<div class="admonition-important admonition">
<p class="first admonition-title">Important</p>
<p class="last">Any broken JSON syntax in the <tt class="docutils literal"><span class="pre">INPUT</span></tt> section,
or in the optional sections <tt class="docutils literal"><span class="pre">ABBREVIATIONS</span></tt>,
<tt class="docutils literal"><span class="pre">BIBENTRIES</span></tt> or <tt class="docutils literal"><span class="pre">CITATIONS</span></tt>
will raise an error during
this phase of processing.</p>
</div>
<!--  -->
<blockquote>
<pre class="literal-block">
./tools/MAKETESTS.sh
</pre>
</blockquote>
<p>The command above performs two tasks: (a) it writes Javascript
wrappers for each fixture to an appropriate file in the <tt class="docutils literal"><span class="pre">./tests/</span></tt>
directory; and (b) it invokes the <tt class="docutils literal"><span class="pre">./std/grind.py</span></tt> command to
processs the human-readable test fixtures under <tt class="docutils literal"><span class="pre">./std/humans/</span></tt>
into the machine-friendly JSON format, storing the resulting files
under <tt class="docutils literal"><span class="pre">./std/machines/</span></tt>.  After this command is run successfully,
the tests are ready to go.</p>
<p><strong>Running the tests</strong></p>
<p>For information of the three test runners bundled with
<tt class="docutils literal"><span class="pre">citeproc-js</span></tt>, see the section <a class="reference internal" href="#setup-and-system-requirements">Setup and System Requirements</a>,
above.</p>
</div>
</div>
</div>
</body>
</html>
